"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,a=!1,o=void 0;try{for(var c,l=e[Symbol.iterator]();!(n=(c=l.next()).done)&&(i.push(c.value),!t||i.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function getDom(e){return document.querySelector(e)}function dataURL2blob(e){for(var t=e.split(",")[1],i=atob(t),n=new Uint8Array(i.length),a=0;a<i.length;a++)n[a]=i.charCodeAt(a);return new Blob([n],{type:"image/png"})}function decode(e){return decodeURIComponent(e).split(",").map(function(e){return String.fromCharCode(parseInt(e,16)-3)}).join("")}function urlSearchParams(){var e=window.location.search.substring(1),t={};if(e)for(var i=e.split("&"),n=i.length;n;){var a=i[--n].split("=");t[decodeURIComponent(a[0])]=a[1]?decodeURIComponent(a[1]):void 0}return t}var searchParams=urlSearchParams(),s=searchParams.s||"",URL=window.URL||window.webkitURL,devicePixelRatio=window.devicePixelRatio||1;function init(){var e=getDom("#pageRead"),t=getDom("#pageMain"),i=(getDom("#pageNo"),getDom("#pagePhone")),n=getDom("#pageCard"),a=getDom("#pageSign"),o=getDom("#btnRead"),c=getDom("#btnBackRead"),l=getDom("#btnScrollPhone"),r=getDom("#btnScrollCard"),d=getDom("#btnScrollSign"),g=getDom("#noDownload"),h=getDom("#btnBackSign"),u=getDom("#btnDownload"),m=getDom("#downloadImg"),v=(getDom("#downloadLink"),null),p=[308,215,66,30],w=null,f=[562,216,250,30],R=null,D=[222,250,190,30],x=null,P=[548,250,250,30],L=null,y=[622,2520,200,90],I=getDom("#agreementCanvas"),b=I.getContext("2d"),C=getDom("#signCanvas"),S=C.getContext("2d"),E=getDom("#btnSignClear"),k=getDom("#btnSignSubmit"),T=getDom("#noCanvas"),U=T.getContext("2d"),A=getDom("#phoneCanvas"),j=A.getContext("2d"),B=getDom("#phoneInput"),V=getDom("#btnPhoneSubmit"),X=getDom("#cardCanvas"),Y=X.getContext("2d"),O=getDom("#cardInput"),_=getDom("#btnCardSubmit");function q(e){return new Promise(function(t,i){var n=new Image;n.onload=function(){var i=n.width,a=n.height;t({img:n,src:e,width:i,height:a})},n.onerror=function(e){i(e)},n.src=e})}T.width=f[2]*devicePixelRatio,T.height=f[3]*devicePixelRatio,A.width=D[2]*devicePixelRatio,A.height=D[3]*devicePixelRatio,X.width=P[2]*devicePixelRatio,X.height=P[3]*devicePixelRatio,C.width=y[2]*devicePixelRatio,C.height=y[3]*devicePixelRatio,o.addEventListener("click",function(){e.classList.add("hide"),t.classList.remove("hide"),window.scrollTo(0,0)}),c.addEventListener("click",function(){e.classList.remove("hide"),t.classList.add("hide"),window.scrollTo(0,0)}),h.addEventListener("click",function(){g.classList.add("hide"),t.classList.remove("hide"),window.scrollTo(0,0)}),l.addEventListener("click",function(){i.scrollIntoView()}),r.addEventListener("click",function(){n.scrollIntoView()}),d.addEventListener("click",function(){a.scrollIntoView()}),window.scrollTo(0,0),V.addEventListener("click",function(){var e=B.value;j.clearRect(0,0,A.width*devicePixelRatio,A.height*devicePixelRatio),j.font=24*devicePixelRatio+"px sans-self",j.fillStyle="#000000",j.fillText(e,0,23*devicePixelRatio,D[2]*devicePixelRatio),b.putImageData(R,D[0],D[1]),b.drawImage.apply(b,[A].concat(D)),window.scrollTo(0,0)}),_.addEventListener("click",function(){var e=O.value;Y.clearRect(0,0,X.width*devicePixelRatio,X.height*devicePixelRatio),Y.font=24*devicePixelRatio+"px sans-self",Y.fillStyle="#000000",Y.fillText(e,0,23*devicePixelRatio,P[2]*devicePixelRatio),b.putImageData(x,P[0],P[1]),b.drawImage.apply(b,[X].concat(P)),window.scrollTo(0,0)}),E.addEventListener("click",function(){S.clearRect(0,0,C.width,C.height)}),k.addEventListener("click",function(){b.putImageData(v,p[0],p[1]),b.putImageData(L,y[0],y[1]),b.drawImage.apply(b,[C].concat(y)),b.drawImage.apply(b,[C].concat(p)),I.scrollIntoView(!1)}),Promise.all([q("img/1-85f22fc3a7.jpg"),q("img/2-9d455d0392.jpg")]).then(function(e){var t=_slicedToArray(e,2),i=t[0],n=t[1],a=i.width,o=i.height+n.height;I.width=a,I.height=o,b.drawImage(i.img,0,0,i.width,i.height),b.drawImage(n.img,0,i.height,n.width,n.height),v=b.getImageData.apply(b,p),w=b.getImageData.apply(b,f),R=b.getImageData.apply(b,D),x=b.getImageData.apply(b,P),L=b.getImageData.apply(b,y),U.clearRect(0,0,T.width*devicePixelRatio,T.height*devicePixelRatio),U.font=24*devicePixelRatio+"px sans-self",U.fillStyle="#000000",U.fillText(s,0,23*devicePixelRatio,f[2]*devicePixelRatio),b.putImageData(w,f[0],f[1]),b.drawImage.apply(b,[T].concat(f))}).catch(function(e){console.log(e),alert("图片加载失败")}),function(e,t){var i=!1;function n(t){return t*e.width/a}t.strokeStyle="#000000",t.lineWidth=2*devicePixelRatio,t.lineCap="round";var a=0,o=0,c=0;function l(l){l.preventDefault();var r=e.getBoundingClientRect();o=r.left,c=r.top,a=r.width,r.height;var d=0,s=0;"mousedown"===l.type?(d=l.clientX,s=l.clientY):"touchstart"===l.type&&(d=l.touches[0].clientX,s=l.touches[0].clientY),i=!0,t.beginPath(),t.moveTo(n(d-o),n(s-c))}function r(e){if(i){e.preventDefault();var a=0,l=0;"mousemove"===e.type?(a=e.clientX,l=e.clientY):"touchmove"===e.type&&(a=e.touches[0].clientX,l=e.touches[0].clientY),t.lineTo(n(a-o),n(l-c)),t.stroke()}}function d(e){i&&(t.closePath(),i=!1)}e.addEventListener("mousedown",l,!1),e.addEventListener("mousemove",r,!1),e.addEventListener("mouseup",d),e.addEventListener("mouseout",d),e.addEventListener("touchstart",l),e.addEventListener("touchmove",r),e.addEventListener("touchend",d),e.addEventListener("touchcancel",d)}(C,S),u.addEventListener("click",function(){var e=I.toDataURL("image/png"),i=dataURL2blob(e);URL.createObjectURL(i);m.src=e,g.classList.remove("hide"),t.classList.add("hide"),window.scrollTo(0,0),setTimeout(function(){alert("长按图片保存或发送")},1e3)})}s?(s=decode(s),init()):alert("页面地址错误");